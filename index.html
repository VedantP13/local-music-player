<!DOCTYPE html> 
 <html lang="en"> 

 <head> 
 	 <link rel="manifest" href="manifest.json"> 
 	 <meta name="theme-color" content="#121212"> 
 	 
 	 <link rel="icon" href="images/icon-192x192.png" type="image/png"> 

 	 <meta property="og:type" content="website"> 
 <meta property="og:url" content="https://vedantp13.github.io/local-music-player/"> 
 <meta property="og:title" content="Musiqua - Liquid Glass Music Player"> 
 <meta property="og:description" content="A modern, offline-first music player with a stunning liquid glass interface. Load your local music folder and enjoy!"> 
 <meta property="og:image" content="https://vedantp13.github.io/local-music-player/images/og-image.png"> 

 <meta property="twitter:card" content="summary_large_image"> 
 <meta property="twitter:url" content="https://vedantp13.github.io/local-music-player/"> 
 <meta property="twitter:title" content="Musiqua - Glass Music Player"> 
 <meta property="twitter:description" content="A modern, offline-first music player with a stunning liquid glass interface. Load your local music folder and enjoy!"> 
 <meta property="twitter:image" content="https://vedantp13.github.io/local-music-player/images/og-image.png"> 

 	 <meta charset="UTF-8"> 
 	 <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
 	 <title>Liquid Glass Music Player</title> 
 	 <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script> 
 	 <link rel="preconnect" href="https://fonts.googleapis.com"> 
 	 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
 	 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet"> 
 	 <style> 
 		 /* --- CSS Variables and Base Styles --- */ 
 		 :root { 
 			 --bg-color: #121212; 
 			 --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
 			 --glass-bg: rgba(255, 255, 255, 0.08); 
 			 /* More transparent base */ 
 			 --glass-border: rgba(255, 255, 255, 0.1); 
 			 /* Softer border */ 
 			 --shadow-color: rgba(0, 0, 0, 0.25); 
 			 --primary-text: #ffffff; 
 			 --secondary-text: #cccccc; 
 			 /* Increased contrast for better visibility */ 
 			 --highlight-bg: rgba(255, 255, 255, 0.1); 
 			 /* More subtle highlight */ 
 			 --blur-amount: 30px; 
 			 /* Slightly less blur for a clearer look */ 
 			 --saturation-amount: 180%; 
 			 --border-radius: 24px; 
 		 } 

 		 * { 
 			 box-sizing: border-box; 
 			 margin: 0; 
 			 padding: 0; 
 		 } 

 		 html, 
 		 body { 
 			 min-height: 100%; 
 			 /* Allow body to grow vertically */ 
 			 overflow: hidden; 
 			 /* Prevent horizontal scroll from blobs */ 
 		 } 

 		 body { 
 			 background-color: var(--bg-color); 
 			 font-family: var(--font-family); 
 			 color: var(--primary-text); 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 padding: 2rem; 
 		 } 

 		 /* --- Animated Liquid Background --- */ 
 		 .background-container { 
 			 position: fixed; 
 			 top: 0; 
 			 left: 0; 
 			 width: 100%; 
 			 height: 100%; 
 			 z-index: -1; 
 			 overflow: hidden; 
 			 filter: blur(100px) saturate(1.1); 
 			 /* Blends the blobs into a soft gradient */ 
 			 transition: filter 0.5s ease-out, opacity 0.75s ease-in-out; 
 			 /* For beat reaction & hiding for album art */ 
 		 } 

 		 .blob { 
 			 position: absolute; 
 			 border-radius: 50%; 
 			 opacity: 0.6; 
 			 transition: background 1.5s ease-in-out; 
 			 /* Smooth color transition for blobs */ 
 		 } 

 		 .blob:nth-child(1) { 
 			 width: 50vmax; 
 			 height: 50vmax; 
 			 top: -20%; 
 			 left: -20%; 
 			 background: #4e00c2; 
 			 animation: move 25s infinite alternate; 
 		 } 

 		 .blob:nth-child(2) { 
 			 width: 40vmax; 
 			 height: 40vmax; 
 			 top: 60%; 
 			 left: 70%; 
 			 background: #0093e9; 
 			 animation: move 30s -10s infinite alternate; 
 		 } 

 		 .blob:nth-child(3) { 
 			 width: 30vmax; 
 			 height: 30vmax; 
 			 top: 20%; 
 			 left: 50%; 
 			 background: #80d0c7; 
 			 animation: move 20s -5s infinite alternate; 
 		 } 

 		 @keyframes move { 
 			 from { 
 				 transform: translate(-20%, 10%) rotate(0deg) scale(1); 
 			 } 

 			 to { 
 				 transform: translate(10%, -20%) rotate(360deg) scale(1.2); 
 			 } 
 		 } 


 		 /* --- Main App Container --- */ 
 		 .music-player { 
 			 display: grid; 
 			 grid-template-columns: 350px 1fr; 
 			 gap: 20px; 
 			 width: 100%; 
 			 max-width: 900px; 
 			 height: 580px; 
 			 max-height: 90vh; 
 		 } 

 		 /* --- Base Glass Panel Style --- */ 
 		 .glass-panel { 
 			 background: var(--glass-bg); 
 			 backdrop-filter: blur(var(--blur-amount)) saturate(var(--saturation-amount)); 
 			 border-radius: var(--border-radius); 
 			 border: 1px solid var(--glass-border); 
 			 box-shadow: 0 10px 30px var(--shadow-color); 
 			 padding: 30px; 
 			 display: flex; 
 			 flex-direction: column; 
 			 position: relative; 
 			 overflow: hidden; 
 		 } 

 		 /* --- Player Panel (Left) --- */ 
 		 .player-panel { 
 			 text-align: center; 
 		 } 
 		 
 		 /* Album Art Background Effect */ 
 		 .player-panel::before { 
 			 content: ''; 
 			 position: absolute; 
 			 top: 0; left: 0; right: 0; bottom: 0; 
 			 background-image: var(--album-art-bg); 
 			 background-size: cover; 
 			 background-position: center; 
 			 filter: blur(40px) brightness(0.7) saturate(1.2); 
 			 transform: scale(1.1); /* Ensure blur doesn't create hard edges */ 
 			 z-index: -1; 
 			 opacity: 0; 
 			 transition: opacity 0.75s ease-in-out; 
 		 } 

 		 .player-panel.has-art::before { 
 			 opacity: 1; 
 		 } 
 		 
 		 #album-art { 
 			 transition: opacity 0.4s ease-in-out; 
 			 cursor: pointer; 
 		 } 

 		 #album-art:active { 
 			 cursor: grabbing; 
 		 } 

 		 #track-info { 
 			 width: 100%; 
 			 overflow: hidden; 
 			 /* Prevents long titles from expanding the container */ 
 			 transition: opacity 0.4s ease-in-out; 
 			 z-index: 1; 
 		 } 

 		 #track-info.fade-out, 
 		 #album-art.fade-out { 
 			 opacity: 0; 
 		 } 

 		 #track-info h2 { 
 			 font-size: 1.5rem; 
 			 margin-bottom: 0.5rem; 
 			 white-space: nowrap; 
 			 overflow: hidden; 
 			 text-overflow: ellipsis; 
 			 text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5); 
 		 } 

 		 #track-info p { 
 			 color: var(--secondary-text); 
 			 font-size: 1rem; 
 			 text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5); 
 			 white-space: nowrap; 
 			 overflow: hidden; 
 			 text-overflow: ellipsis; 
 		 } 

 		 .placeholder-art { 
 			 width: 100%; 
 			 aspect-ratio: 1/1; 
 			 background: rgba(0, 0, 0, 0.2); 
 			 border-radius: 16px; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 margin-bottom: 20px; 
 			 overflow: hidden; 
 			 z-index: 1; 
 		 } 

 		 #album-art-img { 
 			 width: 100%; 
 			 height: 100%; 
 			 object-fit: cover; 
 			 display: none; 
 		 } 
 		 
 		 #album-art-placeholder {
 			width: 100%;
 			height: 100%;
 			display: flex;
 			align-items: center;
 			justify-content: center;
             position: relative;
 		}
 		 
 		 #album-art-placeholder svg { 
 			 width: 100px; 
 			 height: 100px; 
 			 color: var(--secondary-text); 
              transition: opacity 0.3s ease-in-out, transform 0.2s ease-out, filter 0.2s ease-out;
 		 } 

 		 /* --- Controls & Sliders --- */ 
 		 .controls-wrapper { 
 			 margin-top: auto; 
 			 z-index: 1; 
 			 /* This pushes the controls to the bottom respecting padding */ 
 		 } 

 		 .progress-bar-container { 
 			 width: 100%; 
 			 margin-bottom: 1rem; 
 		 } 

 		 .time-display { 
 			 display: flex; 
 			 justify-content: space-between; 
 			 font-size: 0.8rem; 
 			 color: var(--secondary-text); 
 			 margin-bottom: 5px; 
 			 text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5); 
 		 } 

 		 .playback-controls { 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 gap: 20px; 
 			 margin-bottom: 1rem; 
 		 } 

 		 .control-btn { 
 			 position: relative; 
 			 overflow: hidden; 
 			 background: 
 				 radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.2), transparent 60%), 
 				 var(--glass-bg); 
 			 border: 1px solid rgba(255, 255, 255, 0.1); 
 			 color: var(--primary-text); 
 			 cursor: pointer; 
 			 width: 44px; 
 			 height: 44px; 
 			 border-radius: 50%; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); 
 			 box-shadow: 
 				 inset 0 1px 2px rgba(255, 255, 255, 0.25), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.15), 
 				 0 4px 8px rgba(0, 0, 0, 0.3); 
 		 } 

 		 .control-btn .icon-container { 
 			 position: relative; 
 			 width: 24px; 
 			 height: 24px; 
 		 } 

 		 .control-btn .icon-container svg { 
 			 position: absolute; 
 			 top: 0; 
 			 left: 0; 
 			 width: 100%; 
 			 height: 100%; 
 		 } 

 		 .control-btn:hover { 
 			 background-color: var(--highlight-bg); 
 			 box-shadow: 
 				 inset 0 1px 1px rgba(255, 255, 255, 0.3), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.1), 
 				 0 8px 15px rgba(0, 0, 0, 0.3); 
 		 } 

 		 .control-btn:active { 
 			 transform: scale(0.95); 
 			 box-shadow: 
 				 inset 0 3px 4px rgba(0, 0, 0, 0.3), 
 				 0 1px 2px rgba(0, 0, 0, 0.4); 
 		 } 

 		 .control-btn.active { 
 			 background-color: rgba(100, 180, 255, 0.2); 
 			 box-shadow: 
 				 inset 0 1px 2px rgba(255, 255, 255, 0.25), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.15), 
 				 0 0 15px rgba(100, 180, 255, 0.4), 
 				 0 4px 8px rgba(0, 0, 0, 0.3); 
 		 } 

 		 #play-pause-btn { 
 			 width: 52px; 
 			 height: 52px; 
 			 transform: scale(1.1); 
 		 } 

 		 #play-pause-btn:hover { 
 			 background-color: var(--highlight-bg); 
 		 } 
 		 
 		 .control-btn svg { 
 			 width: 24px; 
 			 height: 24px; 
 		 } 

 		 #play-pause-btn svg { 
 			 width: 32px; 
 			 height: 32px; 
 		 } 

 		 .volume-container { 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 gap: 8px; 
 			 color: var(--primary-text); 
 		 } 
 		 
 		 #volume-btn { 
 			 position: relative; 
 			 top: 2px; 
 			 /* Nudge for better visual alignment */ 
 			 background: transparent; 
 			 border: none; 
 			 cursor: pointer; 
 			 width: 30px; 
 			 height: 40px; 
 			 border-radius: 50%; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: left; 
 			 transition: all 0.2s ease; 
 			 box-shadow: none; 
 			 color: var(--secondary-text); 
 			 /* Set icon color to light grey */ 
 		 } 

 		 #volume-btn:hover { 
 			 transform: scale(1.15); 
 		 } 

 		 #volume-btn:active { 
 			 transform: scale(0.95); 
 		 } 

 		 #volume-btn svg { 
 			 width: 24px; 
 			 height: 24px; 
 		 } 

 		 input[type="range"] { 
 			 -webkit-appearance: none; 
 			 appearance: none; 
 			 width: 100%; 
 			 height: 12px; 
 			 background: transparent; 
 			 outline: none; 
 			 cursor: pointer; 
 		 } 

 		 input[type="range"]::-webkit-slider-thumb { 
 			 -webkit-appearance: none; 
 			 appearance: none; 
 			 width: 20px; 
 			 height: 20px; 
 			 background: 
 				 radial-gradient(circle at 50% 40%, rgba(255, 255, 255, 0.25), transparent 70%), 
 				 rgba(255, 255, 255, 0.1); 
 			 border-radius: 50%; 
 			 border: 1px solid rgba(255, 255, 255, 0.15); 
 			 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.35), 
 				 inset 0 1px 1px rgba(255, 255, 255, 0.3), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.1); 
 			 margin-top: -4px; 
 			 transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
 		 } 

 		 input[type="range"]::-moz-range-thumb { 
 			 width: 20px; 
 			 height: 20px; 
 			 background: 
 				 radial-gradient(circle at 50% 40%, rgba(255, 255, 255, 0.25), transparent 70%), 
 				 rgba(255, 255, 255, 0.1); 
 			 border-radius: 50%; 
 			 border: 1px solid rgba(255, 255, 255, 0.15); 
 			 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.35), inset 0 1px 1px rgba(255, 255, 255, 0.3), inset 0 -1px 1px rgba(0, 0, 0, 0.1); 
 		 } 

 		 input[type="range"].slider-active::-webkit-slider-thumb { 
 			 transform: scale(1.25); 
 			 transition: transform 0.1s ease-out; 
 		 } 

 		 input[type="range"]:hover::-webkit-slider-thumb { 
 			 transform: scale(1.15); 
 		 } 

 		 input[type="range"]:hover::-moz-range-thumb { 
 			 transform: scale(1.15); 
 		 } 

 		 input[type="range"]::-webkit-slider-runnable-track { 
 			 height: 12px; 
 			 background: linear-gradient(to right, 
 					 rgba(255, 255, 255, 0.15) var(--fill-percent, 0%), 
 					 rgba(0, 0, 0, 0.25) var(--fill-percent, 0%)); 
 			 border-radius: 10px; 
 			 box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5); 
 		 } 

 		 input[type="range"]::-moz-range-track { 
 			 height: 12px; 
 			 background: rgba(0, 0, 0, 0.25); 
 			 border-radius: 10px; 
 			 box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5); 
 		 } 

 		 input[type="range"]::-moz-range-progress { 
 			 height: 12px; 
 			 background: rgba(255, 255, 255, 0.15); 
 			 border-radius: 10px; 
 		 } 

 		 /* --- Playlist Panel (Right) --- */ 
 		 .playlist-panel { 
 			 overflow: hidden; 
 		 } 

 		 #playlist-header { 
 			 margin-bottom: 20px; 
 			 display: flex; 
 			 justify-content: space-between; 
 			 align-items: center; 
 		 } 

 		 #playlist-header h2 { 
 			 font-size: 1.5rem; 
 		 } 

 		 #playlist-header-controls { 
 			 display: flex; 
 			 gap: 8px; 
 		 } 

 		 .playlist { 
 			 list-style: none; 
 			 height: 100%; 
 			 overflow-y: auto; 
 			 padding: 0 10px; 
 			 position: relative; 
 		 } 
 		 
 		 .active-track-highlighter { 
 			 position: absolute; 
 			 left: 10px; 
 			 width: calc(100% - 20px); 
 			 border-radius: 8px; 
 			 background: 
 				 radial-gradient(ellipse at 50% 0%, rgba(255, 255, 255, 0.12), transparent 80%), 
 				 rgba(255, 255, 255, 0.12); 
 			 box-shadow: 
 				 inset 0 1px 1px rgba(255, 255, 255, 0.15), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.1), 
 				 0 5px 10px rgba(0, 0, 0, 0.2); 
 			 border: 1px solid rgba(255, 255, 255, 0.12); 
 			 transition: top 0.35s cubic-bezier(0.25, 0.8, 0.25, 1), height 0.35s cubic-bezier(0.25, 0.8, 0.25, 1); 
 			 z-index: 0; 
 			 opacity: 0; 
 		 } 

 		 .active-track-highlighter.visible { 
 			 opacity: 1; 
 		 } 

 		 .playlist::-webkit-scrollbar { 
 			 width: 14px; 
 		 } 

 		 .playlist::-webkit-scrollbar-track { 
 			 background: transparent; 
 		 } 

 		 .playlist::-webkit-scrollbar-thumb { 
 			 background-color: rgba(255, 255, 255, 0.2); 
 			 border-radius: 10px; 
 			 border: 4px solid transparent; 
 			 background-clip: content-box; 
 			 transition: background-color 0.2s; 
 		 } 

 		 .playlist::-webkit-scrollbar-thumb:hover { 
 			 background-color: rgba(255, 255, 255, 0.4); 
 		 } 

 		 .playlist-item { 
 			 display: flex; 
 			 align-items: center; 
 			 gap: 12px; 
 			 padding: 10px 16px; 
 			 margin-bottom: 8px; 
 			 border-radius: 8px; 
 			 cursor: pointer; 
 			 transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1); 
 			 transform: scale(1); 
 			 position: relative; 
 			 z-index: 1; 
 		 } 

 		 .playlist-item.dragging { 
 			 opacity: 0.5; 
 			 background: var(--highlight-bg); 
 		 } 

 		 .playlist-item-art { 
 			 width: 40px; 
 			 height: 40px; 
 			 flex-shrink: 0; 
 			 border-radius: 6px; 
 			 background-color: rgba(0, 0, 0, 0.2); 
 			 overflow: hidden; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 		 } 

 		 .playlist-item-img { 
 			 width: 100%; 
 			 height: 100%; 
 			 object-fit: cover; 
 		 } 

 		 .playlist-item-art svg { 
 			 width: 22px; 
 			 height: 22px; 
 			 color: var(--secondary-text); 
 		 } 

 		 .playlist-item-info { 
 			 display: flex; 
 			 flex-direction: column; 
 			 justify-content: center; 
 			 overflow: hidden; 
 			 text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5); 
 			 flex-grow: 1; 
 		 } 

 		 .playlist-item-title, 
 		 .playlist-item-artist { 
 			 white-space: nowrap; 
 			 overflow: hidden; 
 			 text-overflow: ellipsis; 
 		 } 

 		 .playlist-item-title { 
 			 font-size: 0.9rem; 
 			 font-weight: 500; 
 			 color: var(--primary-text); 
 		 } 

 		 .playlist-item-artist { 
 			 font-size: 0.8rem; 
 			 color: var(--secondary-text); 
 		 } 

 		 .now-playing-indicator { 
 			 display: none; 
 			 align-items: center; 
 			 gap: 4px; 
 			 height: 20px; 
 			 margin-left: auto; 
 		 } 

 		 .playlist-item.active.is-playing .now-playing-indicator { 
 			 display: flex; 
 		 } 

 		 .now-playing-indicator span { 
 			 width: 6px; 
 			 height: 6px; 
 			 background-color: var(--secondary-text); 
 			 border-radius: 50%; 
 			 animation: bounce 1.3s ease-in-out infinite; 
 		 } 

 		 .playlist-item.active.is-playing .now-playing-indicator span { 
 			 background-color: var(--primary-text); 
 		 } 

 		 .now-playing-indicator span:nth-child(1) { animation-delay: 0.0s; } 
 		 .now-playing-indicator span:nth-child(2) { animation-delay: 0.2s; } 
 		 .now-playing-indicator span:nth-child(3) { animation-delay: 0.4s; } 
 		 
 		 @keyframes bounce {
           0%, 80%, 100% {
             transform: scale(0.4);
             opacity: 0.5;
           }
           40% {
             transform: scale(1.0);
             opacity: 1;
           }
         }

 		 .playlist-item-drag-handle, 
 		 .playlist-item-remove-btn { 
 			 display: none; 
 			 align-items: center; 
 			 justify-content: center;
 			 color: var(--secondary-text); 
 			 cursor: pointer; 
 			 transition: color 0.2s; 
 			 padding: 4px; 
 			 flex-shrink: 0; 
 		 } 

 		 .playlist-item-drag-handle { 
 			 cursor: grab; 
 			 margin-right: 8px; 
 		 } 
          .playlist-item-drag-handle svg, 
          .playlist-item-remove-btn svg {
             width: 20px;
             height: 20px;
          }

 		 .playlist-item-drag-handle:hover, 
 		 .playlist-item-remove-btn:hover { 
 			 color: var(--primary-text); 
 		 } 

 		 .playlist-item-remove-btn { 
 			 color: #ff8a8a; 
 			 margin-left: auto; 
 		 } 

 		 .playlist-item-remove-btn:hover { 
 			 color: #ff4d4d; 
 		 } 

 		 .playlist.edit-mode .playlist-item-drag-handle, 
 		 .playlist.edit-mode .playlist-item-remove-btn { 
 			 display: flex; 
 		 } 

 		 .playlist.edit-mode .playlist-item { 
 			 cursor: grab; 
 		 } 

 		 .playlist.edit-mode .playlist-item:active { 
 			 cursor: grabbing; 
 		 } 

 		 .playlist-item:hover { 
 			 background-color: var(--highlight-bg); 
 		 } 

 		 .playlist-item.active { 
 			transform: scale(1.03); 
 		 } 
 		 
 		 .playlist-item.active .playlist-item-title { 
 			 font-weight: 700; 
 		 } 

 		 #folder-selector { 
 			 display: flex; 
 			 flex-direction: column; 
 			 align-items: center; 
 			 justify-content: center; 
 			 height: 100%; 
 			 text-align: center; 
 		 } 

 		 #folder-selector h3 { 
 			 font-weight: 500; 
 			 margin-bottom: 8px; 
 		 } 

 		 #folder-selector p { 
 			 color: var(--secondary-text); 
 		 } 

 		 #select-folder-btn { 
 			 position: relative; 
 			 overflow: hidden; 
 			 background: 
 				 radial-gradient(ellipse at 50% 0%, rgba(255, 255, 255, 0.2), transparent 80%), 
 				 var(--glass-bg); 
 			 backdrop-filter: blur(10px) saturate(150%); 
 			 border: 1px solid var(--glass-border); 
 			 color: var(--primary-text); 
 			 padding: 15px 30px; 
 			 border-radius: 50px; 
 			 font-size: 1rem; 
 			 font-weight: 500; 
 			 cursor: pointer; 
 			 transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); 
 			 box-shadow: 
 				 inset 0 1px 2px rgba(255, 255, 255, 0.25), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.15), 
 				 0 4px 8px rgba(0, 0, 0, 0.3); 
 			 margin-top: 1rem; 
 		 } 

 		 #select-folder-btn:hover { 
 			 transform: scale(1.05) translateY(-2px); 
 			 background-color: var(--highlight-bg); 
 			 box-shadow: 
 				 inset 0 1px 1px rgba(255, 255, 255, 0.3), 
 				 inset 0 -1px 1px rgba(0, 0, 0, 0.1), 
 				 0 8px 15px rgba(0, 0, 0, 0.25); 
 		 } 

 		 #select-folder-btn:active { 
 			 transform: scale(0.98); 
 			 box-shadow: inset 0 3px 4px rgba(0, 0, 0, 0.25); 
 		 } 
 		 
 		 @keyframes highlight-folder-btn { 
 			 0% { 
 				 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); 
 				 transform: scale(1.05) translateY(-2px); 
 			 } 

 			 50% { 
 				 box-shadow: 0 8px 25px rgba(255, 255, 255, 0.4); 
 				 transform: scale(1.1) translateY(-4px); 
 			 } 

 			 100% { 
 				 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); 
 				 transform: scale(1.05) translateY(-2px); 
 			 } 
 		 } 

 		 #select-folder-btn.highlight { 
 			 animation: highlight-folder-btn 1.2s ease-in-out; 
 		 } 

 		 #folder-input { 
 			 display: none; 
 		 } 

 		 .ripple { 
 			 position: absolute; 
 			 border-radius: 50%; 
 			 background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 70%); 
 			 transform: scale(0); 
 			 animation: ripple-animation 0.6s cubic-bezier(0.25, 0.8, 0.25, 1); 
 			 pointer-events: none; 
 		 } 

 		 @keyframes ripple-animation { 
 			 to { 
 				 transform: scale(3); 
 				 opacity: 0; 
 			 } 
 		 } 

 		 @keyframes wobble-effect { 
 			 0% { 
 				 transform: scale(0.95); 
 			 } 

 			 50% { 
 				 transform: scale(1.15) translateY(-2px); 
 			 } 

 			 100% { 
 				 transform: scale(1); 
 			 } 
 		 } 

 		 @keyframes play-wobble-effect { 
 			 0% { 
 				 transform: scale(1.05); 
 			 } 

 			 50% { 
 				 transform: scale(1.25) translateY(-2px); 
 			 } 

 			 100% { 
 				 transform: scale(1.1); 
 			 } 
 		 } 

 		 .wobble-animate { 
 			 animation: wobble-effect 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important; 
 		 } 

 		 #play-pause-btn.wobble-animate { 
 			 animation: play-wobble-effect 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important; 
 		 } 
 		 
 		 /* Fullscreen Player Styles */ 
 		 #fullscreen-player { 
 			 position: fixed; 
 			 top: 0; 
 			 left: 0; 
 			 width: 100%; 
 			 height: 100%; 
 			 background: var(--bg-color); 
 			 z-index: 100; 
 			 display: flex; 
 			 flex-direction: column; 
 			 justify-content: space-between; 
 			 padding: 5vh 5vw; 
 			 transform: translateY(100%); 
 			 transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
 			 touch-action: none; /* Prevent scrolling but allow gestures */ 
 		 } 
 		 #fullscreen-player.open { 
 			 transform: translateY(0); 
 		 } 

         #fullscreen-player .fs-background {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             z-index: -2;
             opacity: 0;
             transition: opacity 0.75s ease-in-out;
         }

 		 #fullscreen-player::before { 
 			 content: ''; 
 			 position: absolute; 
 			 top: 0; left: 0; right: 0; bottom: 0; 
 			 background-image: var(--album-art-bg); 
 			 background-size: cover; 
 			 background-position: center; 
 			 filter: blur(80px) brightness(0.6) saturate(1.2); 
 			 transform: scale(1.1); 
 			 z-index: -1; 
 			 opacity: 0; 
 			 transition: opacity 0.75s ease-in-out; 
 		 } 
 		 #fullscreen-player.has-art::before { 
 			 opacity: 1; 
 		 } 
 		 .close-handle { 
 			 position: absolute; 
 			 top: 20px; 
 			 left: 50%; 
 			 transform: translateX(-50%); 
 			 width: 50px; 
 			 height: 5px; 
 			 background-color: rgba(255,255,255,0.3); 
 			 border-radius: 5px; 
 		 } 
 		 .fullscreen-album-art { 
 			 width: 100%; 
 			 max-width: 70vh; 
 			 max-height: 70vh; 
 			 aspect-ratio: 1/1; 
 			 margin: 0 auto; 
 			 border-radius: 20px; 
 			 overflow: hidden; 
 			 box-shadow: 0 15px 40px rgba(0,0,0,0.4); 
 		 } 
 		 .fullscreen-album-art img { 
 			 width: 100%; 
 			 height: 100%; 
 			 object-fit: cover; 
 		 } 
 		  #fullscreen-album-art-placeholder { 
 			 width: 100%; 
 			 height: 100%; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 background-color: rgba(0, 0, 0, 0.2); 
              position: relative;
 		 } 

 		 #fullscreen-album-art-placeholder svg { 
 			 width: 120px; 
 			 height: 120px; 
 			 color: var(--secondary-text); 
 			 opacity: 0.8; 
              transition: opacity 0.3s ease-in-out, transform 0.2s ease-out, filter 0.2s ease-out;
 		 } 
 		 .fullscreen-track-info { 
 			 text-align: center; 
 			 padding: 2rem 1rem; 
 		 } 
 		 .fullscreen-track-info h2 { 
 			 font-size: 1.8rem; 
 			 margin-bottom: 0.5rem; 
 		 } 
 		 .fullscreen-track-info p { 
 			 font-size: 1.1rem; 
 			 color: var(--secondary-text); 
 		 } 
 		 #fullscreen-controls-wrapper { 
 			 width: 100%; 
 			 max-width: 500px; 
 			 margin: 0 auto; 
 		 } 
 		 #fullscreen-controls-wrapper .time-display { 
 			  font-size: 1rem; 
 		 } 
 		 #fullscreen-controls-wrapper .control-btn { 
 			  transform: scale(1.1); 
 		 } 
 		 #fullscreen-controls-wrapper #play-pause-btn { 
 			  transform: scale(1.2); 
 		 } 



 		 /* --- Responsive Design --- */ 
 		 @media (max-width: 800px) { 

 			 html, 
 			 body { 
 				 overflow-y: auto; 
 			 } 

 			 body { 
 				 padding: 1rem; 
 				 align-items: flex-start; 
 			 } 

 			 .music-player { 
 				 grid-template-columns: 1fr; 
 				 grid-template-rows: auto 1fr; 
 				 max-width: 420px; 
 				 height: auto; 
 				 min-height: 90vh; 
 				 max-height: none; 
 				 gap: 15px; 
 			 } 

 			 .glass-panel { 
 				 padding: 20px; 
 			 } 

 			 #track-info h2 { 
 				 font-size: 1.25rem; 
 			 } 

 			 #track-info p { 
 				 font-size: 0.9rem; 
 			 } 

 			 .playback-controls { 
 				 gap: 15px; 
 			 } 

 			 .control-btn { 
 				 width: 42px; 
 				 height: 42px; 
 			 } 

 			 #play-pause-btn { 
 				 width: 50px; 
 				 height: 50px; 
 			 } 

 			 .control-btn svg { 
 				 width: 22px; 
 				 height: 22px; 
 			 } 

 			 #play-pause-btn svg { 
 				 width: 30px; 
 				 height: 30px; 
 			 } 

 			 .playlist { 
 				 padding: 0 5px; 
 			 } 

 			 .active-track-highlighter { 
 				 left: 5px; 
 				 width: calc(100% - 10px); 
 			 } 
 		 } 
 		 
 		 /* --- Fullscreen Desktop Design --- */ 
 		 @media (min-width: 1200px) { 
 			 body { 
 				 padding: 0; 
 				 overflow: hidden; 
 			 } 
 			 
 			 .music-player { 
 				 grid-template-columns: 1fr 400px; 
 				 width: 100vw; 
 				 height: 100vh; 
 				 max-width: none; 
 				 max-height: none; 
 				 border-radius: 0; 
 				 gap: 0; 
 			 } 
 			 
 			 .glass-panel { 
 				 border-radius: 0; 
 				 border: none; 
 				 box-shadow: none; 
 				 padding: 3rem 2.5rem; 
 				 height: 100%; 
 			 } 
 			 
 			 .player-panel { 
 				 border-right: 1px solid var(--glass-border); 
 			 } 
 			 
 			 .playlist-panel { 
 				 border-right: none; 
 				 display: flex; 
 				 flex-direction: column; 
 				 padding: 3rem 1.5rem; /* Symmetrical horizontal padding */ 
 			 } 
 			 
 			 .player-panel>div:first-child { 
 				 flex-grow: 1; 
 				 display: flex; 
 				 flex-direction: column; 
 				 justify-content: center; 
 				 align-items: center; 
 				 width: 100%; 
 				 min-height: 0; 
 			 } 
 			 
 			 .controls-wrapper { 
 				 margin-top: 2rem; 
 				 padding-bottom: 0; 
 				 max-width: 500px; 
 				 width: 100%; 
 				 margin-left: auto; 
 				 margin-right: auto; 
 				 flex-shrink: 0; 
 			 } 
 			 
 			 .placeholder-art { 
 				 width: 100%; 
 				 max-width: 400px; 
 				 aspect-ratio: 1 / 1; 
 				 margin-left: auto; 
 				 margin-right: auto; 
 				 margin-bottom: 2.5rem; 
 			 } 
 			 
 			 #track-info h2 { 
 				 font-size: 2rem; 
 			 } 
 			 
 			 #track-info p { 
 				 font-size: 1.2rem; 
 			 } 

 			 #playlist-header { 
 				  margin-bottom: 30px; 
 			 } 

 			 #folder-selector { 
 				 flex-grow: 1; 
 			 } 

 			 #playlist-header-controls { 
 				 gap: 12px; 
 			 } 
 			 
 			 .playlist { 
 				 padding: 0 1rem; /* Add padding for scrollbar and balance */ 
 				 flex-grow: 1; 
 				 min-height: 0; 
 			 } 

 			 .active-track-highlighter { 
 				 left: 1rem; 
 				 width: calc(100% - 2rem); 
 			 } 
 		 } 
 		 
 		 /* Desktop-only Album Glow for Playlist */ 
 		 @media (min-width: 1200px) { 
 			 .playlist-panel { 
 				 --album-glow-color: transparent; 
 			 } 

 			 .playlist-panel::before { 
 				 content: ''; 
 				 position: absolute; 
 				 top: 50%; 
 				 left: 50%; 
 				 width: 200%; 
 				 height: 200%; 
 				 transform: translate(-50%, -50%); 
 				 background: radial-gradient(circle, var(--album-glow-color) 0%, transparent 60%); 
 				 filter: blur(100px); 
 				 z-index: -1; 
 				 opacity: 0; 
 				 transition: opacity 0.75s ease-in-out, background 0.75s ease-in-out; 
 			 } 

 			 .playlist-panel.has-glow::before { 
 				 opacity: 1; 
 			 } 
 		 } 


 		 /* --- Marquee Animation for long text --- */ 
 		 @keyframes marquee { 
 			 from { 
 				 transform: translateX(0); 
 			 } 

 			 to { 
 				 transform: translateX(-50%); 
 			 } 
 		 } 

 		 #track-info.playing h2.scrolling, 
 		 #track-info.playing p.scrolling, 
          .fullscreen-track-info h2.scrolling,
          .fullscreen-track-info p.scrolling,
 		 .playlist-item.active .playlist-item-title.scrolling, 
 		 .playlist-item.active .playlist-item-artist.scrolling { 
 			 text-overflow: clip; 
 		 } 

 		 #track-info.playing .scrolling span, 
          .fullscreen-track-info .scrolling span,
 		 .playlist-item.active .scrolling span { 
 			 display: inline-block; 
 			 animation: marquee 25s linear infinite; 
 		 } 
 	 </style> 
 </head> 

 <body> 
 	 <div class="background-container"> 
 		 <div class="blob"></div> 
 		 <div class="blob"></div> 
 		 <div class="blob"></div> 
 	 </div> 

 	 <div class="music-player"> 
 		 <div class="glass-panel player-panel"> 
 			 <div> 
 				 <div class="placeholder-art" id="album-art"> 
 					 <img id="album-art-img" src="" alt="Album Art"> 
 					 <div id="album-art-placeholder"> 
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                             <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55c-2.21 0-4 1.79-4 4s1.79 4 4 4s4-1.79 4-4V7h4V3h-6z"/>
                         </svg>
 					 </div> 
 				 </div> 
 				 <div id="track-info"> 
 					 <h2 id="track-title">No song playing</h2> 
 					 <p id="track-artist">Select a folder to begin</p> 
 				 </div> 
 			 </div> 

 			 <div class="controls-wrapper"> 
 				 <div class="progress-bar-container"> 
 					 <div class="time-display"> 
 						 <span id="current-time">0:00</span> 
 						 <span id="total-duration">0:00</span> 
 					 </div> 
 					 <input type="range" id="progress-bar" value="0" step="1"> 
 				 </div> 

 				 <div class="playback-controls"> 
 					 <button class="control-btn" id="prev-btn" aria-label="Previous Song"> 
 						 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 6h2v12H6zm3.5 6 8.5 6V6l-8.5 6z"/></svg>
 					 </button> 
 					 <button class="control-btn" id="play-pause-btn" aria-label="Play/Pause"> 
 						 <span id="play-icon"> 
 							 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
 						 </span> 
 						 <span id="pause-icon" style="display: none;"> 
 							 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
 						 </span> 
 					 </button> 
 					 <button class="control-btn" id="next-btn" aria-label="Next Song"> 
 						 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 18l8.5-6L6 6v12zM16 6h2v12h-2z"/></svg>
 					 </button> 
 				 </div> 
 				 <div class="volume-container"> 
 					 <button id="volume-btn" aria-label="Mute/Unmute"> 
 						 <span id="volume-icon"> 
 							 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" 
 								 fill="currentColor"> 
 								 <path 
 									 d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" /> 
 							 </svg> 
 						 </span> 
 						 <span id="mute-icon" style="display: none;"> 
 							 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" 
 								 fill="currentColor"> 
 								 <path 
 									 d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" /> 
 							 </svg> 
 						 </span> 
 					 </button> 
 					 <input type="range" id="volume-slider" value="80" min="0" max="100"> 
 				 </div> 
 			 </div> 
 		 </div> 

 		 <div class="glass-panel playlist-panel"> 
 			 <div id="playlist-header"> 
 				 <h2>Playlist</h2> 
 				 <div id="playlist-header-controls"> 
 					 <button class="control-btn" id="change-folder-btn" title="Select another folder"> 
 						 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 4H4c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.89-2-2-2h-8l-2-2z"/></svg>
 					 </button> 
 					 <button class="control-btn" id="edit-playlist-btn" title="Reorder Playlist"> 
 						 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 15h18v-2H3v2zm0 4h18v-2H3v2zm0-8h18V9H3v2zm0-6v2h18V5H3z"/></svg>
 					 </button> 
 					 <button class="control-btn" id="repeat-btn" aria-label="Repeat"> 
 						 <div class="icon-container"> 
 							 <svg id="repeat-icon-all" xmlns="http://www.w3.org/2000/svg" width="24" height="24" 
 								 viewBox="0 0 24" fill="currentColor"> 
 								 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z" /> 
 							 </svg> 
 							 <svg id="repeat-icon-one" style="display: none;" xmlns="http://www.w3.org/2000/svg" 
 								 width="24" height="24" viewBox="0 0 24" fill="currentColor"> 
 								 <path 
 									 d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v2.5H13z" /> 
 							 </svg> 
 						 </div> 
 					 </button> 
 					 <button class="control-btn" id="shuffle-btn" aria-label="Shuffle"> 
 						 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
 					 </button> 
 				 </div> 
 			 </div> 

 			 <div id="folder-selector"> 
 				 <h3>Your music library is empty.</h3> 
 				 <p>Select a local folder to start listening.</p> 
 				 <button id="select-folder-btn">Select Music Folder</button> 
 				 <input type="file" id="folder-input" webkitdirectory directory> 
 			 </div> 

 			 <ul id="playlist" class="playlist" style="display: none;"> 
 				 <!-- Playlist items will be injected here by JavaScript --> 
 			 </ul> 
 		 </div> 
 	 </div> 
 	 
 	 <div id="fullscreen-player"> 
         <div class="background-container fs-background" style="opacity: 0;">
             <div class="blob"></div>
             <div class="blob"></div>
             <div class="blob"></div>
         </div>
 		 <div class="close-handle"></div> 
 		 <div class="fullscreen-album-art"> 
 			 <img id="fullscreen-album-art-img" src="" alt="Album Art"> 
 			 <div id="fullscreen-album-art-placeholder" style="display: none;"> 
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                     <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55c-2.21 0-4 1.79-4 4s1.79 4 4 4s4-1.79 4-4V7h4V3h-6z"/>
                 </svg>
 			 </div> 
 		 </div> 
 		 <div class="fullscreen-track-info"> 
 			 <h2 id="fullscreen-track-title"></h2> 
 			 <p id="fullscreen-track-artist"></p> 
 		 </div> 
 		 <div id="fullscreen-controls-wrapper"> 
 			  <!-- Controls will be cloned here --> 
 		 </div> 
 	 </div> 

 	 <script> 
 		 document.addEventListener('DOMContentLoaded', () => { 
 			 // --- DOM Element References --- 
 			 const audio = new Audio(); 
 			 const folderInput = document.getElementById('folder-input'); 
 			 const selectFolderBtn = document.getElementById('select-folder-btn'); 
 			 const folderSelectorView = document.getElementById('folder-selector'); 
 			 const playlistView = document.getElementById('playlist'); 
 			 const playerPanel = document.querySelector('.player-panel'); 
 			 const playlistPanel = document.querySelector('.playlist-panel'); 
 			 const backgroundContainer = document.querySelector('.background-container'); 
 			 
 			 const fullscreenPlayer = document.getElementById('fullscreen-player'); 
 			 const fullscreenAlbumArtContainer = document.querySelector('.fullscreen-album-art');
 			 const fullscreenAlbumArtImg = document.getElementById('fullscreen-album-art-img'); 
 			 const fullscreenAlbumArtPlaceholder = document.getElementById('fullscreen-album-art-placeholder'); 
 			 const fullscreenTrackTitle = document.getElementById('fullscreen-track-title'); 
 			 const fullscreenTrackArtist = document.getElementById('fullscreen-track-artist'); 
 			 const fullscreenControlsWrapper = document.getElementById('fullscreen-controls-wrapper'); 


 			 const trackInfo = document.getElementById('track-info'); 
 			 const albumArtContainer = document.getElementById('album-art'); 
 			 const trackTitle = document.getElementById('track-title'); 
 			 const trackArtist = document.getElementById('track-artist'); 
 			 const albumArtImg = document.getElementById('album-art-img'); 
 			 const albumArtPlaceholder = document.getElementById('album-art-placeholder'); 
 			 
 			 const mainControlsWrapper = document.querySelector('.controls-wrapper'); 

 			 const playPauseBtn = document.getElementById('play-pause-btn'); 
 			 const playIcon = document.getElementById('play-icon'); 
 			 const pauseIcon = document.getElementById('pause-icon'); 
 			 const prevBtn = document.getElementById('prev-btn'); 
 			 const nextBtn = document.getElementById('next-btn'); 
 			 const shuffleBtn = document.getElementById('shuffle-btn'); 
 			 const repeatBtn = document.getElementById('repeat-btn'); 
 			 const repeatIconAll = document.getElementById('repeat-icon-all'); 
 			 const repeatIconOne = document.getElementById('repeat-icon-one'); 
 			 const changeFolderBtn = document.getElementById('change-folder-btn'); 
 			 const editPlaylistBtn = document.getElementById('edit-playlist-btn'); 

 			 const progressBar = document.getElementById('progress-bar'); 
 			 const currentTimeEl = document.getElementById('current-time'); 
 			 const totalDurationEl = document.getElementById('total-duration'); 
 			 const volumeSlider = document.getElementById('volume-slider'); 
 			 const volumeBtn = document.getElementById('volume-btn'); 
 			 const volumeIcon = document.getElementById('volume-icon'); 
 			 const muteIcon = document.getElementById('mute-icon'); 

 			 // --- State Management --- 
 			 let playlist = []; 
 			 let currentIndex = 0; 
 			 let isShuffled = false; 
 			 let isEditingPlaylist = false; 
 			 let repeatState = 0; // 0: no-repeat, 1: repeat-all, 2: repeat-one 
 			 let preMuteVolume = 0.8; 
 			 let touchStartX = 0; 
 			 let touchEndX = 0; 
              let fsSwipeStartX = 0;
             let fsSwipeEndX = 0;
             let fsSwipeStartY = 0;
             let fsSwipeEndY = 0;
             let isDraggingControls = false;

 			 // --- Web Audio API for Visualization --- 
 			 let audioContext; 
 			 let analyser; 
 			 let source; 
 			 let dataArray; 
 			 let isAudioContextSetup = false; 

 			 // --- File & Playlist Handling --- 
 			 selectFolderBtn.addEventListener('click', () => folderInput.click()); 
 			 changeFolderBtn.addEventListener('click', () => { 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 folderInput.click() 
 			 }); 
 			 folderInput.addEventListener('change', handleFolderSelection); 

 			 async function handleFolderSelection(event) { 
 				 const files = Array.from(event.target.files); 
 				 const audioFiles = files.filter(file => /\.(mp3|wav|ogg|flac|m4a)$/i.test(file.name)); 

 				 if (audioFiles.length === 0) { 
 					 alert('No supported audio files found in the selected folder.'); 
 					 return; 
 				 } 

 				 playlistView.innerHTML = `<li class="playlist-item" style="justify-content: center;">Loading music...</li>`; 
 				 folderSelectorView.style.display = 'none'; 
 				 playlistView.style.display = 'block'; 

 				 const readTags = (file) => new Promise((resolve) => { 
 					 const trackInfo = { 
 						 name: file.name.replace(/\.[^/.]+$/, ""), 
 						 url: URL.createObjectURL(file), 
 						 fileObject: file, 
 						 title: file.name.replace(/\.[^/.]+$/, ""), 
 						 artist: "Unknown Artist", 
 						 albumArtUrl: null 
 					 }; 

 					 window.jsmediatags.read(file, { 
 						 onSuccess: (tag) => { 
 							 const { artist, title, picture } = tag.tags; 
 							 trackInfo.title = title || trackInfo.name; 
 							 trackInfo.artist = artist || "Unknown Artist"; 
 							 if (picture) { 
 								 let binary = ''; 
 								 const bytes = picture.data; 
 								 const len = bytes.length; 
 								 for (let i = 0; i < len; i++) { 
 									 binary += String.fromCharCode(bytes[i]); 
 								 } 
 								 const base64String = btoa(binary); 
 								 trackInfo.albumArtUrl = `data:${picture.format};base64,${base64String}`; 
 							 } 
 							 resolve(trackInfo); 
 						 }, 
 						 onError: (error) => { 
 							 console.log(`Could not read metadata for ${file.name}:`, error.type, error.info); 
 							 resolve(trackInfo); 
 						 } 
 					 }); 
 				 }); 

 				 playlist = await Promise.all(audioFiles.map(file => readTags(file))); 
 				 renderPlaylist(); 
 				 loadTrack(0); 
 			 } 

 			 function setupScrollableText(element, text) { 
 				 element.classList.remove('scrolling'); 
 				 // Set the plain text content first to accurately measure if it overflows 
 				 element.textContent = text; 

 				 // Check if the element's scroll width is greater than its visible width 
 				 if (element.scrollWidth > element.clientWidth) { 
 					 // If it overflows, add the scrolling class 
 					 element.classList.add('scrolling'); 
 					 // Then, wrap the duplicated text in a span for the CSS animation 
 					 element.innerHTML = `<span>${text}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${text}</span>`; 
 				 } 
 				 // If it doesn't overflow, the text content is already correctly set and no class is needed. 
 			 } 

 			 function renderPlaylist() { 
 				 playlistView.innerHTML = ''; 
 				 
 				 const highlighter = document.createElement('div'); 
 				 highlighter.className = 'active-track-highlighter'; 
 				 playlistView.appendChild(highlighter); 

 				 playlist.forEach((track, index) => { 
 					 const li = document.createElement('li'); 
 					 li.className = 'playlist-item'; 
 					 li.dataset.index = index; 
 					 li.draggable = isEditingPlaylist; 

 					 const dragHandle = document.createElement('div'); 
 					 dragHandle.className = 'playlist-item-drag-handle'; 
 					 dragHandle.title = 'Drag to reorder'; 
 					 dragHandle.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 9H4v2h16V9zM4 15h16v-2H4v2z"/></svg>`; 

 					 const artContainer = document.createElement('div'); 
 					 artContainer.className = 'playlist-item-art'; 

 					 if (track.albumArtUrl) { 
 						 const img = document.createElement('img'); 
 						 img.className = 'playlist-item-img'; 
 						 img.src = track.albumArtUrl; 
 						 artContainer.appendChild(img); 
 					 } else { 
 						 artContainer.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>`; 
 					 } 

 					 const infoContainer = document.createElement('div'); 
 					 infoContainer.className = 'playlist-item-info'; 

 					 const titleEl = document.createElement('div'); 
 					 titleEl.className = 'playlist-item-title'; 
 					 setupScrollableText(titleEl, track.title); 

 					 const artistEl = document.createElement('div'); 
 					 artistEl.className = 'playlist-item-artist'; 
 					 setupScrollableText(artistEl, track.artist); 

 					 infoContainer.appendChild(titleEl); 
 					 infoContainer.appendChild(artistEl); 

 					 const nowPlayingIndicator = document.createElement('div'); 
 					 nowPlayingIndicator.className = 'now-playing-indicator'; 
 					 nowPlayingIndicator.innerHTML = `<span></span><span></span><span></span>`; 

 					 const removeBtn = document.createElement('div'); 
 					 removeBtn.className = 'playlist-item-remove-btn'; 
 					 removeBtn.title = 'Remove from playlist'; 
 					 removeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"/></svg>`; 

 					 li.appendChild(dragHandle); 
 					 li.appendChild(artContainer); 
 					 li.appendChild(infoContainer); 
 					 li.appendChild(nowPlayingIndicator); 
 					 li.appendChild(removeBtn); 

 					 li.addEventListener('click', (e) => { 
 						 if (isEditingPlaylist) return; 
 						 currentIndex = index; 
 						 loadTrack(currentIndex, true); 
 					 }); 

 					 removeBtn.addEventListener('click', (e) => { 
 						 e.stopPropagation(); 
 						 removeTrack(index); 
 					 }); 

 					 playlistView.appendChild(li); 
 				 }); 
 				 updateActiveTrackHighlight(); 
 				 setupDragAndDrop(); 
 			 } 

 			 // --- Playback Logic --- 
 			 function loadTrack(index, isPlaying = false) { 
 				 document.querySelector('.playlist-item.is-playing')?.classList.remove('is-playing'); 
 				 if (index < 0 || index >= playlist.length) { 
 					 if (playlist.length === 0) { 
 						 setupScrollableText(trackTitle, "No song playing"); 
 						 setupScrollableText(trackArtist, "Select a folder to begin"); 
 						 albumArtImg.src = ''; 
 						 albumArtImg.style.display = 'none'; 
 						 albumArtPlaceholder.style.display = 'flex'; 
 						 audio.src = ''; 
 						 pauseTrack(); 
 					 } 
 					 return; 
 				 }; 

 				 albumArtContainer.classList.add('fade-out'); 
 				 trackInfo.classList.add('fade-out'); 
                 
 				 setTimeout(() => { 
 					 const track = playlist[index]; 
 					 audio.src = track.url; 

 					 setupScrollableText(trackTitle, track.title); 
 					 setupScrollableText(trackArtist, track.artist); 
 					 
 					 if (fullscreenPlayer.classList.contains('open')) { 
 						 updateFullscreenPlayer(); 
 					 } 
                      
                      const fsBackground = fullscreenPlayer.querySelector('.fs-background');

 					 if (track.albumArtUrl) { 
                         albumArtImg.src = track.albumArtUrl;
                         albumArtImg.style.display = 'block';
                         albumArtPlaceholder.style.display = 'none';
 						 
 						 playerPanel.style.setProperty('--album-art-bg', `url(${track.albumArtUrl})`); 
 						 fullscreenPlayer.style.setProperty('--album-art-bg', `url(${track.albumArtUrl})`); 
 						 playerPanel.classList.add('has-art'); 
 						 fullscreenPlayer.classList.add('has-art'); 
 						 backgroundContainer.style.opacity = '0'; 
                         fsBackground.style.opacity = '0';

 						 const img = new Image(); 
 						 img.crossOrigin = "Anonymous"; 
 						 img.onload = () => { 
 							 const canvas = document.createElement('canvas'); 
 							 const ctx = canvas.getContext('2d'); 
 							 canvas.width = 1; 
 							 canvas.height = 1; 
 							 ctx.drawImage(img, 0, 0, 1, 1); 
 							 const data = ctx.getImageData(0, 0, 1, 1).data; 
 							 const [h, s, l] = rgbToHsl(data[0], data[1], data[2]); 
 							 const color = `hsla(${h}, ${Math.min(s, 60)}%, ${Math.min(l, 40)}%, 0.5)`; 
 							 playlistPanel.style.setProperty('--album-glow-color', color); 
 							 playlistPanel.classList.add('has-glow'); 
 						 }; 
 						 img.src = track.albumArtUrl; 
 					 } else { 
 						 albumArtImg.src = ''; 
 						 albumArtImg.style.display = 'none'; 
 						 albumArtPlaceholder.style.display = 'flex';
 						 playerPanel.classList.remove('has-art'); 
 						 playlistPanel.classList.remove('has-glow'); 
 						 fullscreenPlayer.classList.remove('has-art'); 
 						 backgroundContainer.style.opacity = '1'; 
                         if (fullscreenPlayer.classList.contains('open')) {
                             fsBackground.style.opacity = '1';
                         }
 					 } 

 					 const colors = generateColorsFromText(track.title); 
                      const allBlobs = document.querySelectorAll('.blob');
 					 allBlobs.forEach((blob, i) => {
                         blob.style.background = colors[i % 3];
                      });


 					 albumArtContainer.classList.remove('fade-out'); 
 					 trackInfo.classList.remove('fade-out'); 

 					 if (isPlaying) { 
 						 playTrack(); 
 					 } else { 
 						 pauseTrack(); 
 					 } 
 					 
 					 if ('mediaSession' in navigator) { 
 						 const artwork = track.albumArtUrl ? [{ src: track.albumArtUrl, sizes: '512x512', type: 'image/jpeg' }] : []; 
 						 navigator.mediaSession.metadata = new MediaMetadata({ 
 							 title: track.title, 
 							 artist: track.artist, 
 							 album: 'Musiqua', 
 							 artwork: artwork 
 						 }); 
 					 } 

 				 }, 250); 

 				 updateActiveTrackHighlight(); 
 			 } 

 			 function playTrack() { 
 				 if (!audio.src) return; 
 				 if (!isAudioContextSetup) { 
 					 setupAudioAnalysis(); 
 				 } 
 				 if (audioContext.state === 'suspended') { 
 					 audioContext.resume(); 
 				 } 
 				 audio.play(); 
                 document.querySelectorAll('#play-icon').forEach(icon => icon.style.display = 'none');
                 document.querySelectorAll('#pause-icon').forEach(icon => icon.style.display = 'block');
 				 trackInfo.classList.add('playing'); 
 				 document.querySelector(`.playlist-item[data-index='${currentIndex}']`)?.classList.add('is-playing'); 
 				 if ('mediaSession' in navigator) { 
 					 navigator.mediaSession.playbackState = 'playing'; 
 				 } 
 			 } 

 			 function pauseTrack() { 
 				 audio.pause(); 
                 document.querySelectorAll('#play-icon').forEach(icon => icon.style.display = 'block');
                 document.querySelectorAll('#pause-icon').forEach(icon => icon.style.display = 'none');
 				 trackInfo.classList.remove('playing'); 
 				 document.querySelector('.playlist-item.is-playing')?.classList.remove('is-playing'); 
 				 if ('mediaSession' in navigator) { 
 					 navigator.mediaSession.playbackState = 'paused'; 
 				 } 
 			 } 

 			 function playPauseToggle() { 
 				 triggerHapticFeedback(); 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 if (audio.src) { 
 					 audio.paused ? playTrack() : pauseTrack(); 
 				 } else if (playlist.length > 0) { 
 					 currentIndex = 0; 
 					 loadTrack(0, true); 
 				 } 
 			 } 

 			 function handleTrackEnd() { 
 				 if (repeatState === 2) { 
 					 audio.currentTime = 0; 
 					 playTrack(); 
 				 } else if (repeatState === 0 && currentIndex === playlist.length - 1 && !isShuffled) { 
 					 pauseTrack(); 
 				 } else { 
 					 nextTrack(); 
 				 } 
 			 } 

 			 function nextTrack() { 
 				 triggerHapticFeedback(); 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 if (isShuffled) { 
 					 let nextIndex; 
 					 if (playlist.length === 1) { 
 						 nextIndex = 0; 
 					 } else { 
 						 do { 
 							 nextIndex = Math.floor(Math.random() * playlist.length); 
 						 } while (nextIndex === currentIndex); 
 					 } 
 					 currentIndex = nextIndex; 
 				 } else { 
 					 currentIndex = (currentIndex + 1) % playlist.length; 
 				 } 
 				 loadTrack(currentIndex, true); 
 			 } 

 			 function prevTrack() { 
 				 triggerHapticFeedback(); 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 if (isShuffled) { 
 					 nextTrack(); 
 					 return; 
 				 } else { 
 					 currentIndex = (currentIndex - 1 + playlist.length) % playlist.length; 
 				 } 
 				 loadTrack(currentIndex, true); 
 			 } 

 			 function toggleShuffle() { 
 				 triggerHapticFeedback(); 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 isShuffled = !isShuffled; 
 				 shuffleBtn.classList.toggle('active', isShuffled); 
 			 } 

 			 function toggleRepeat() { 
 				 triggerHapticFeedback(); 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 repeatState = (repeatState + 1) % 3; 
 				 updateRepeatButton(); 
 			 } 

 			 // --- Playlist Editing Logic --- 
 			 function toggleEditPlaylist() { 
 				 triggerHapticFeedback(); 
 				 if (playlist.length === 0) { 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 isEditingPlaylist = !isEditingPlaylist; 
 				 playlistView.classList.toggle('edit-mode', isEditingPlaylist); 
 				 editPlaylistBtn.classList.toggle('active', isEditingPlaylist); 
 				 renderPlaylist(); 
 			 } 

 			 function removeTrack(indexToRemove) { 
 				 const wasPlaying = !audio.paused && currentIndex === indexToRemove; 

 				 playlist.splice(indexToRemove, 1); 

 				 if (playlist.length === 0) { 
 					 currentIndex = -1; 
 					 loadTrack(currentIndex); 
 				 } else { 
 					 if (currentIndex > indexToRemove || currentIndex === playlist.length) { 
 						 currentIndex--; 
 					 } 
 					 if (currentIndex === indexToRemove) { 
 						 loadTrack(currentIndex, wasPlaying); 
 					 } 
 				 } 
 				 renderPlaylist(); 
 			 } 

 			 function setupDragAndDrop() { 
 				 if (!isEditingPlaylist) return; 

 				 let draggedItem = null; 

 				 const handleDragEnd = () => { 
 					 if (!draggedItem) return; 
 					 draggedItem.classList.remove('dragging'); 

 					 const currentPlayingUrl = playlist[currentIndex] ?.url; 
 					 const domOrderMap = Array.from(playlistView.querySelectorAll('.playlist-item')).map(li => { 
 						 return parseInt(li.dataset.index); 
 					 }); 

 					 playlist = domOrderMap.map(originalIndex => playlist[originalIndex]); 

 					 currentIndex = playlist.findIndex(track => track.url === currentPlayingUrl); 
 					 if (currentIndex === -1 && playlist.length > 0) currentIndex = 0; 
 					 
 					 triggerHapticFeedback(); 
 					 draggedItem = null; 
 					 renderPlaylist(); 
 				 }; 

 				 playlistView.querySelectorAll('.playlist-item').forEach(item => { 
 					 item.addEventListener('dragstart', (e) => { 
 						 draggedItem = item; 
 						 setTimeout(() => item.classList.add('dragging'), 0); 
 					 }); 

 					 item.addEventListener('dragend', handleDragEnd); 

 					 item.addEventListener('dragover', e => { 
 						 e.preventDefault(); 
 						 const afterElement = getDragAfterElement(playlistView, e.clientY); 
 						 if (afterElement == null) { 
 							 playlistView.appendChild(draggedItem); 
 						 } else { 
 							 playlistView.insertBefore(draggedItem, afterElement); 
 						 } 
 					 }); 

 					 item.addEventListener('touchstart', (e) => { 
 						 if (e.target.closest('.playlist-item-drag-handle')) { 
 							 draggedItem = item; 
 							 item.classList.add('dragging'); 
 						 } 
 					 }, { passive: true }); 

 					 item.addEventListener('touchmove', (e) => { 
 						 if (!draggedItem) return; 
 						 e.preventDefault(); 
 						 const y = e.touches[0].clientY; 
 						 const afterElement = getDragAfterElement(playlistView, y); 
 						 if (afterElement == null) { 
 							 playlistView.appendChild(draggedItem); 
 						 } else { 
 							 playlistView.insertBefore(draggedItem, afterElement); 
 						 } 
 					 }, { passive: false }); 

 					 item.addEventListener('touchend', handleDragEnd); 
 				 }); 
 			 } 

 			 function getDragAfterElement(container, y) { 
 				 const draggableElements = [...container.querySelectorAll('.playlist-item:not(.dragging)')]; 
 				 return draggableElements.reduce((closest, child) => { 
 					 const box = child.getBoundingClientRect(); 
 					 const offset = y - box.top - box.height / 2; 
 					 if (offset < 0 && offset > closest.offset) { 
 						 return { offset: offset, element: child }; 
 					 } else { 
 						 return closest; 
 					 } 
 				 }, { offset: Number.NEGATIVE_INFINITY }).element; 
 			 } 

 			 function updateRepeatButton() { 
 				 repeatBtn.classList.remove('active'); 
 				 repeatIconAll.style.display = 'none'; 
 				 repeatIconOne.style.display = 'none'; 

 				 if (repeatState === 0) { 
 					 repeatIconAll.style.display = 'block'; 
 				 } else if (repeatState === 1) { 
 					 repeatBtn.classList.add('active'); 
 					 repeatIconAll.style.display = 'block'; 
 				 } else { 
 					 repeatBtn.classList.add('active'); 
 					 repeatIconOne.style.display = 'block'; 
 				 } 
 			 } 

 			 function updateActiveTrackHighlight() { 
 				 const activeItem = document.querySelector(`.playlist-item[data-index='${currentIndex}']`); 
 				 const highlighter = document.querySelector('.active-track-highlighter'); 

 				 document.querySelectorAll('.playlist-item.active').forEach(item => { 
 					 item.classList.remove('active'); 
 				 }); 

 				 if (activeItem && highlighter) { 
 					 activeItem.classList.add('active'); 
 					 highlighter.style.top = `${activeItem.offsetTop}px`; 
 					 highlighter.style.height = `${activeItem.offsetHeight}px`; 
 					 highlighter.classList.add('visible'); 
 					 if (window.matchMedia("(min-width: 801px)").matches && !isEditingPlaylist) { 
 						 activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
 					 } 
 				 } else if (highlighter) { 
 					 highlighter.classList.remove('visible'); 
 				 } 
 			 } 
 			 
 			 function promptToSelectFolder() { 
 				 // For mobile view, scroll to the button 
 				 if (window.matchMedia("(max-width: 800px)").matches) { 
 					 folderSelectorView.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
 				 } 
 				 
 				 // Animate the button to draw attention 
 				 selectFolderBtn.classList.add('highlight'); 
 				 selectFolderBtn.addEventListener('animationend', () => { 
 					 selectFolderBtn.classList.remove('highlight'); 
 				 }, { once: true }); 
 			 } 
 			 
 			 // --- Fullscreen Player Logic --- 
 			 function updateFullscreenPlayer() { 
 				 if (playlist.length === 0 || currentIndex < 0) return; 
 				 const track = playlist[currentIndex]; 
                 const fsBackground = fullscreenPlayer.querySelector('.fs-background');

 				 if (track.albumArtUrl) { 
 					 fullscreenAlbumArtImg.src = track.albumArtUrl; 
 					 fullscreenAlbumArtImg.style.display = 'block'; 
 					 fullscreenAlbumArtPlaceholder.style.display = 'none'; 
                      fsBackground.style.opacity = '0';
 				 } else { 
 					 fullscreenAlbumArtImg.src = ''; 
 					 fullscreenAlbumArtImg.style.display = 'none'; 
 					 fullscreenAlbumArtPlaceholder.style.display = 'flex'; 
                      fsBackground.style.opacity = '1';
 				 } 

 				 setupScrollableText(fullscreenTrackTitle, track.title);
                 setupScrollableText(fullscreenTrackArtist, track.artist);
 			 } 
 			 
 			 function openFullscreenPlayer() { 
 				 if (playlist.length === 0) return; 
 				 updateFullscreenPlayer(); 
 				 
 				 fullscreenControlsWrapper.innerHTML = ''; 
 				 const clonedControls = mainControlsWrapper.cloneNode(true); 
 				 fullscreenControlsWrapper.appendChild(clonedControls); 

 				 // Re-wire controls inside the fullscreen player 
 				 const fsPlayPause = clonedControls.querySelector('#play-pause-btn'); 
 				 const fsNext = clonedControls.querySelector('#next-btn'); 
 				 const fsPrev = clonedControls.querySelector('#prev-btn'); 
 				 const fsProgress = clonedControls.querySelector('#progress-bar'); 
 				 const fsVolume = clonedControls.querySelector('#volume-slider'); 
                  const fsVolumeBtn = clonedControls.querySelector('#volume-btn');

                  // Re-apply animations
                  clonedControls.querySelectorAll('.control-btn').forEach(applyButtonEffects);

 				 fsPlayPause.addEventListener('click', playPauseToggle); 
 				 fsNext.addEventListener('click', nextTrack); 
 				 fsPrev.addEventListener('click', prevTrack); 
 				 fsProgress.addEventListener('input', () => {
                     audio.currentTime = fsProgress.value
                 }); 
 				 fsVolume.addEventListener('input', (e) => {
                     const newVolume = e.target.value / 100;
                     audio.volume = newVolume;
                     volumeSlider.value = e.target.value;
                     updateSliderFill(volumeSlider);
                     updateSliderFill(fsVolume);
                 }); 
                  fsVolumeBtn.addEventListener('click', toggleMute);

 				 fullscreenPlayer.classList.add('open'); 
 			 } 
 			 
 			 function closeFullscreenPlayer() { 
 				 fullscreenPlayer.classList.remove('open'); 
 			 } 
 			 
 			 albumArtContainer.addEventListener('click', openFullscreenPlayer); 
 			 
              fullscreenPlayer.addEventListener('touchstart', (e) => {
                 if (e.target.closest('.controls-wrapper') || e.target.closest('.close-handle')) {
                     isDraggingControls = true;
                     return;
                 }
                 isDraggingControls = false;
                 fsSwipeStartX = e.touches[0].clientX;
                 fsSwipeStartY = e.touches[0].clientY;
             }, { passive: true });

             fullscreenPlayer.addEventListener('touchmove', (e) => {
                 if (isDraggingControls) return;
                 fsSwipeEndX = e.touches[0].clientX;
                 fsSwipeEndY = e.touches[0].clientY;
             }, { passive: true });

             fullscreenPlayer.addEventListener('touchend', () => {
                 if (isDraggingControls) {
                     isDraggingControls = false;
                     return;
                 }
                 if (fsSwipeStartX === 0 && fsSwipeStartY === 0) return;

                 const deltaX = fsSwipeEndX - fsSwipeStartX;
                 const deltaY = fsSwipeEndY - fsSwipeStartY;

                 if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 80) { // Horizontal swipe
                     if (deltaX > 0) {
                         prevTrack();
                     } else {
                         nextTrack();
                     }
                 } else if (Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 80) { // Vertical swipe down
                     closeFullscreenPlayer();
                 }

                 // Reset coordinates
                 fsSwipeStartX = 0;
                 fsSwipeEndX = 0;
                 fsSwipeStartY = 0;
                 fsSwipeEndY = 0;
             });


 			 // --- Main Player Swipe Logic --- 
 			 function handleTouchStart(e) { 
 				 // Prevent swipe if it's part of a fullscreen drag 
 				 if (fullscreenPlayer.classList.contains('open')) return; 
 				 touchStartX = e.touches[0].clientX; 
 			 } 

 			 function handleTouchMove(e) { 
 				  if (fullscreenPlayer.classList.contains('open')) return; 
 				 touchEndX = e.touches[0].clientX; 
 			 } 

 			 function handleTouchEnd() { 
 				 if (fullscreenPlayer.classList.contains('open')) return; 
 				 if (touchStartX === 0 || touchEndX === 0) return; // Prevent action if no move 
 				 const threshold = 50; // Min swipe distance 
 				 const swipeDistance = touchStartX - touchEndX; 

 				 if (swipeDistance > threshold) { 
 					 // Swiped left 
 					 nextTrack(); 
 				 } else if (swipeDistance < -threshold) { 
 					 // Swiped right 
 					 prevTrack(); 
 				 } 

 				 // Reset coordinates 
 				 touchStartX = 0; 
 				 touchEndX = 0; 
 			 } 

 			 albumArtContainer.addEventListener('touchstart', handleTouchStart, { passive: true }); 
 			 albumArtContainer.addEventListener('touchmove', handleTouchMove, { passive: true }); 
 			 albumArtContainer.addEventListener('touchend', handleTouchEnd); 


 			 playPauseBtn.addEventListener('click', playPauseToggle); 
 			 nextBtn.addEventListener('click', nextTrack); 
 			 prevBtn.addEventListener('click', prevTrack); 
 			 shuffleBtn.addEventListener('click', toggleShuffle); 
 			 repeatBtn.addEventListener('click', toggleRepeat); 
 			 editPlaylistBtn.addEventListener('click', toggleEditPlaylist); 
 			 volumeBtn.addEventListener('click', toggleMute); 

 			 audio.addEventListener('timeupdate', () => { 
 				 updateProgressBar(); 
 				 const fsProgress = document.querySelector('#fullscreen-controls-wrapper #progress-bar'); 
 				 if (fsProgress) { 
 					 fsProgress.value = audio.currentTime; 
 					 updateSliderFill(fsProgress); 
 				 } 
 			 }); 
 			 audio.addEventListener('loadedmetadata', () => { 
 				 progressBar.max = Math.floor(audio.duration); 
 				 totalDurationEl.textContent = formatTime(audio.duration); 
 				 const fsProgress = document.querySelector('#fullscreen-controls-wrapper #progress-bar'); 
 				 if (fsProgress) { 
 					 fsProgress.max = Math.floor(audio.duration); 
 				 } 
                  const fsTotalDurationEl = document.querySelector('#fullscreen-controls-wrapper #total-duration');
                  if (fsTotalDurationEl) {
                      fsTotalDurationEl.textContent = formatTime(audio.duration);
                  }
 			 }); 
 			 audio.addEventListener('ended', handleTrackEnd); 

 			 progressBar.addEventListener('input', () => { 
 				 if (!audio.src) return; 
 				 audio.currentTime = progressBar.value; 
 				 updateSliderFill(progressBar); 
 			 }); 

 			 volumeSlider.addEventListener('input', (e) => { 
 				 const newVolume = e.target.value / 100; 
 				 audio.volume = newVolume; 
 				 
 				 const fsVolume = fullscreenControlsWrapper.querySelector('#volume-slider'); 
 				 if(fsVolume) {
                     fsVolume.value = e.target.value;
                     updateSliderFill(fsVolume);
                 }

 				 if (newVolume === 0) { 
                     document.querySelectorAll('#volume-icon').forEach(i => i.style.display = 'none');
                     document.querySelectorAll('#mute-icon').forEach(i => i.style.display = 'block');
 				 } else { 
                     document.querySelectorAll('#volume-icon').forEach(i => i.style.display = 'block');
                     document.querySelectorAll('#mute-icon').forEach(i => i.style.display = 'none');
 				 } 
 				 updateSliderFill(e.target); 
 			 }); 

 			 [progressBar, volumeSlider].forEach(slider => { 
 				 slider.addEventListener('mousedown', () => slider.classList.add('slider-active')); 
 				 slider.addEventListener('mouseup', () => slider.classList.remove('slider-active')); 
 				 slider.addEventListener('mouseleave', () => slider.classList.remove('slider-active')); 
 			 }); 

 			 function applyButtonEffects(button) { 
 				 button.addEventListener('touchstart', createRipple, { passive: true }); 
 				 button.addEventListener('mousedown', createRipple); 

 				 // Keep wobble on mouseup/touchend 
 				 const handleInteractionEnd = () => button.classList.add('wobble-animate'); 
 				 button.addEventListener('mouseup', handleInteractionEnd); 
 				 button.addEventListener('touchend', handleInteractionEnd); 
 				 
 				 button.addEventListener('animationend', (e) => { 
 					 if (e.animationName === 'wobble-effect' || e.animationName === 'play-wobble-effect') { 
 						 button.classList.remove('wobble-animate'); 
 					 } 
 				 }); 
 			 } 
 			 document.querySelectorAll('.control-btn, #select-folder-btn').forEach(applyButtonEffects); 

 			 function setupAudioAnalysis() { 
 				 if (isAudioContextSetup) return; 
 				 audioContext = new (window.AudioContext || window.webkitAudioContext)(); 
 				 analyser = audioContext.createAnalyser(); 
 				 source = audioContext.createMediaElementSource(audio); 
 				 source.connect(analyser); 
 				 analyser.connect(audioContext.destination); 
 				 analyser.fftSize = 256; 
 				 const bufferLength = analyser.frequencyBinCount; 
 				 dataArray = new Uint8Array(bufferLength); 
 				 isAudioContextSetup = true; 
 				 visualize(); 
 			 } 
 			 
 			 function visualize() { 
 				 requestAnimationFrame(visualize); 
 				 if (document.hidden || !isAudioContextSetup) { 
 					 return; 
 				 } 
 
                 const svgIcon = albumArtPlaceholder.querySelector('svg');
                 const fsSvgIcon = fullscreenAlbumArtPlaceholder.querySelector('svg');

 				 if (!audio.paused) {
                      analyser.getByteFrequencyData(dataArray);
                      const bassFrequencies = dataArray.slice(0, Math.floor(dataArray.length * 0.2));
                      const averageBass = bassFrequencies.reduce((sum, value) => sum + value, 0) / bassFrequencies.length;
                      
                      const saturation = 1.2 + (averageBass / 255) * 0.4;
                      backgroundContainer.style.filter = `blur(100px) saturate(${saturation.toFixed(2)})`;

                      if (playlist.length > 0 && !playlist[currentIndex].albumArtUrl) {
                         const scale = 1 + (averageBass / 255) * 0.1; // Subtle scale from 1 to 1.1
                         const glowIntensity = 5 + (averageBass / 255) * 15; // Glow radius from 5 to 20
                         const blobColor1 = document.querySelector('.blob:nth-child(1)').style.background;
                         
                         const filterValue = `drop-shadow(0 0 ${glowIntensity}px ${blobColor1 || 'rgba(255,255,255,0.5)'})`;

                         svgIcon.style.transform = `scale(${scale})`;
                         svgIcon.style.filter = filterValue;
                         fsSvgIcon.style.transform = `scale(${scale})`;
                         fsSvgIcon.style.filter = filterValue;
                      }

                 } else {
                      if (backgroundContainer.style.filter !== 'blur(100px) saturate(1.2)') {
                         backgroundContainer.style.filter = 'blur(100px) saturate(1.2)';
                     }
                     svgIcon.style.transform = 'scale(1)';
                     svgIcon.style.filter = 'none';
                     fsSvgIcon.style.transform = 'scale(1)';
                     fsSvgIcon.style.filter = 'none';
                 }
 			 } 

 			 function updateProgressBar() { 
 				 progressBar.value = audio.currentTime; 
 				 currentTimeEl.textContent = formatTime(audio.currentTime); 
 				 updateSliderFill(progressBar); 
 				 
 				 const fsProgress = document.querySelector('#fullscreen-controls-wrapper #progress-bar'); 
 				  if(fsProgress) {
                      fsProgress.value = audio.currentTime;
                      updateSliderFill(fsProgress);
                  }
                  const fsCurrentTimeEl = document.querySelector('#fullscreen-controls-wrapper #current-time');
                  if (fsCurrentTimeEl) {
                      fsCurrentTimeEl.textContent = formatTime(audio.currentTime);
                  }
 			 } 

 			 function formatTime(seconds) { 
 				 if (isNaN(seconds)) return "0:00"; 
 				 const minutes = Math.floor(seconds / 60); 
 				 const secs = Math.floor(seconds % 60); 
 				 return `${minutes}:${secs < 10 ? '0' : ''}${secs}`; 
 			 } 

 			 function updateSliderFill(slider) { 
                 if (!slider) return;
 				 const max = slider.max || 100; 
 				 const min = slider.min || 0; 
 				 const percentage = (slider.value - min) / (max - min) * 100; 
 				 slider.style.setProperty('--fill-percent', `${percentage}%`); 
 			 } 

 			 function generateColorsFromText(str) { 
 				 let hash = 0; 
 				 for (let i = 0; i < str.length; i++) { 
 					 hash = str.charCodeAt(i) + ((hash << 5) - hash); 
 					 hash = hash & hash; 
 				 } 

 				 const hue1 = (hash & 0xFF) % 360; 
 				 const hue2 = ((hash >> 8) & 0xFF) % 360; 
 				 const hue3 = ((hash >> 16) & 0xFF) % 360; 

 				 const saturation = 60; // Reduced from 70 
 				 const lightness = 55; // Increased from 50 

 				 return [ 
 					 `hsl(${hue1}, ${saturation}%, ${lightness}%)`, 
 					 `hsl(${hue2}, ${saturation}%, ${lightness}%)`, 
 					 `hsl(${hue3}, ${saturation}%, ${lightness}%)` 
 				 ]; 
 			 } 

 			 function rgbToHsl(r, g, b) { 
 				 r /= 255, g /= 255, b /= 255; 
 				 let max = Math.max(r, g, b), min = Math.min(r, g, b); 
 				 let h, s, l = (max + min) / 2; 

 				 if (max == min) { 
 					 h = s = 0; // achromatic 
 				 } else { 
 					 let d = max - min; 
 					 s = l > 0.5 ? d / (2 - max - min) : d / (max + min); 
 					 switch (max) { 
 						 case r: h = (g - b) / d + (g < b ? 6 : 0); break; 
 						 case g: h = (b - r) / d + 2; break; 
 						 case b: h = (r - g) / d + 4; break; 
 					 } 
 					 h /= 6; 
 				 } 
 				 return [h * 360, s * 100, l * 100]; 
 			 } 

 			 function createRipple(event) { 
 				 const button = event.currentTarget; 
 				 const circle = document.createElement("span"); 
 				 const diameter = Math.max(button.clientWidth, button.clientHeight); 
 				 const radius = diameter / 2; 
 				 const rect = button.getBoundingClientRect(); 
 				 
 				 let clientX = event.clientX; 
 				 let clientY = event.clientY; 
 				 if (event.touches && event.touches.length > 0) { 
 					 clientX = event.touches[0].clientX; 
 					 clientY = event.touches[0].clientY; 
 				 } 

 				 circle.style.width = circle.style.height = `${diameter}px`; 
 				 circle.style.left = `${clientX - rect.left - radius}px`; 
 				 circle.style.top = `${clientY - rect.top - radius}px`; 
 				 circle.classList.add("ripple"); 
 				 const ripple = button.getElementsByClassName("ripple")[0]; 
 				 if (ripple) { 
 					 ripple.remove(); 
 				 } 
 				 button.appendChild(circle); 
 			 } 

 			 function toggleMute() { 
 				 triggerHapticFeedback(); 
                  const newVolume = audio.volume > 0 ? 0 : preMuteVolume;
                  const newSliderValue = newVolume * 100;

                  if (audio.volume > 0) {
                      preMuteVolume = audio.volume;
                  }
 
 				 audio.volume = newVolume;
                  volumeSlider.value = newSliderValue;
                  updateSliderFill(volumeSlider);
 
                  const fsVolumeSlider = fullscreenControlsWrapper.querySelector('#volume-slider');
                  if (fsVolumeSlider) {
                      fsVolumeSlider.value = newSliderValue;
                      updateSliderFill(fsVolumeSlider);
                  }

                 document.querySelectorAll('#volume-icon').forEach(i => i.style.display = newVolume > 0 ? 'block' : 'none');
                 document.querySelectorAll('#mute-icon').forEach(i => i.style.display = newVolume === 0 ? 'block' : 'none');
 			 } 

 			 function triggerHapticFeedback() { 
 				 if (navigator.vibrate) { 
 					 navigator.vibrate(10); 
 				 } 
 			 } 

 			 document.addEventListener('keydown', (e) => { 
 				 if (e.target.tagName === 'INPUT') return; 

 				 if (playlist.length === 0 && (e.code === 'Space' || e.code === 'ArrowRight' || e.code === 'ArrowLeft')) { 
 					 e.preventDefault(); 
 					 promptToSelectFolder(); 
 					 return; 
 				 } 
 				 
 				 switch (e.code) { 
 					 case 'Space': 
 						 e.preventDefault(); 
 						 playPauseToggle(); 
 						 break; 
 					 case 'ArrowRight': 
 						 nextTrack(); 
 						 break; 
 					 case 'ArrowLeft': 
 						 prevTrack(); 
 						 break; 
 					 case 'KeyM': 
 						 toggleMute(); 
 						 break; 
 				 } 
 			 }); 
 			 
 			 function setupMediaSessionHandlers() { 
 				 if ('mediaSession' in navigator) { 
 					 navigator.mediaSession.setActionHandler('play', playPauseToggle); 
 					 navigator.mediaSession.setActionHandler('pause', playPauseToggle); 
 					 navigator.mediaSession.setActionHandler('previoustrack', prevTrack); 
 					 navigator.mediaSession.setActionHandler('nexttrack', nextTrack); 
 				 } 
 			 } 

 			 document.addEventListener('visibilitychange', () => { 
 				 if (document.hidden) { 
 					 if (audioContext && audioContext.state === 'running') { 
 						 audioContext.suspend(); 
 					 } 
 				 } else { 
 					 if (audioContext && audioContext.state === 'suspended') { 
 						 audioContext.resume(); 
 					 } 
 				 } 
 			 }); 

 			 function init() { 
 				 audio.volume = volumeSlider.value / 100; 
 				 preMuteVolume = audio.volume; 
 				 updateSliderFill(volumeSlider); 
 				 updateSliderFill(progressBar); 
 				 setupScrollableText(trackTitle, "No song playing"); 
 				 setupScrollableText(trackArtist, "Select a folder to begin"); 
 				 setupMediaSessionHandlers(); 
 			 } 

 			 init(); 
 		 }); 
 	 </script> 

 	 <script> 
 		 if ('serviceWorker' in navigator) { 
 			 window.addEventListener('load', () => { 
 				 navigator.serviceWorker.register('service-worker.js') 
 					 .then(registration => { 
 						 console.log('ServiceWorker registration successful'); 
 					 }) 
 					 .catch(err => { 
 						 console.log('ServiceWorker registration failed: ', err); 
 					 }); 
 			 }); 
 		 } 
 	 </script> 
 </body> 

 </html>

